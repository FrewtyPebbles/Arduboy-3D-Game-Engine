#pragma once

#include "fixed_point.h"
#include "utility.h"

static const fixed<int16_t, 12> SIN_LUT[40] = {
    0,  // sin(0/39 * pi/2)
    165,  // sin(1/39 * pi/2)
    330,  // sin(2/39 * pi/2)
    494,  // sin(3/39 * pi/2)
    657,  // sin(4/39 * pi/2)
    819,  // sin(5/39 * pi/2)
    980,  // sin(6/39 * pi/2)
    1140,  // sin(7/39 * pi/2)
    1297,  // sin(8/39 * pi/2)
    1452,  // sin(9/39 * pi/2)
    1605,  // sin(10/39 * pi/2)
    1756,  // sin(11/39 * pi/2)
    1904,  // sin(12/39 * pi/2)
    2048,  // sin(13/39 * pi/2)
    2189,  // sin(14/39 * pi/2)
    2327,  // sin(15/39 * pi/2)
    2461,  // sin(16/39 * pi/2)
    2590,  // sin(17/39 * pi/2)
    2716,  // sin(18/39 * pi/2)
    2837,  // sin(19/39 * pi/2)
    2954,  // sin(20/39 * pi/2)
    3066,  // sin(21/39 * pi/2)
    3173,  // sin(22/39 * pi/2)
    3275,  // sin(23/39 * pi/2)
    3371,  // sin(24/39 * pi/2)
    3462,  // sin(25/39 * pi/2)
    3547,  // sin(26/39 * pi/2)
    3627,  // sin(27/39 * pi/2)
    3701,  // sin(28/39 * pi/2)
    3768,  // sin(29/39 * pi/2)
    3830,  // sin(30/39 * pi/2)
    3885,  // sin(31/39 * pi/2)
    3934,  // sin(32/39 * pi/2)
    3977,  // sin(33/39 * pi/2)
    4013,  // sin(34/39 * pi/2)
    4043,  // sin(35/39 * pi/2)
    4066,  // sin(36/39 * pi/2)
    4083,  // sin(37/39 * pi/2)
    4093,  // sin(38/39 * pi/2)
    4096,  // sin(39/39 * pi/2)
};

static const fixed<int16_t, 11> ATAN_LUT_0_TO_12[40] = { // as input x approaches 11.999998999999999 lerp x to 1.487655088009903
    0,  // atan(0.0) = 0.0
    597,  // atan(0.3) = 0.2914567944778671
    1107,  // atan(0.6) = 0.5404195002705842
    1501,  // atan(0.8999999999999999) = 0.7328151017865066
    1794,  // atan(1.2) = 0.8760580505981934
    2013,  // atan(1.5) = 0.982793723247329
    2178,  // atan(1.7999999999999998) = 1.0636978224025597
    2307,  // atan(2.1) = 1.1263771168937977
    2408,  // atan(2.4) = 1.1760052070951352
    2491,  // atan(2.6999999999999997) = 1.2160906747839562
    2558,  // atan(3.0) = 1.2490457723982544
    2614,  // atan(3.3) = 1.2765617616837088
    2662,  // atan(3.5999999999999996) = 1.299849476456476
    2703,  // atan(3.9) = 1.319793640151862
    2738,  // atan(4.2) = 1.3370531459259951
    2769,  // atan(4.5) = 1.3521273809209546
    2796,  // atan(4.8) = 1.3654009376051293
    2820,  // atan(5.1) = 1.3771743339389513
    2842,  // atan(5.3999999999999995) = 1.3876855095324125
    2861,  // atan(5.7) = 1.3971251284533228
    2879,  // atan(6.0) = 1.4056476493802699
    2895,  // atan(6.3) = 1.413379454068306
    2909,  // atan(6.6) = 1.4204248987877621
    2922,  // atan(6.8999999999999995) = 1.4268708774066803
    2934,  // atan(7.199999999999999) = 1.4327903031373772
    2946,  // atan(7.5) = 1.4382447944982226
    2956,  // atan(7.8) = 1.4432867685796584
    2965,  // atan(8.1) = 1.4479610879170015
    2974,  // atan(8.4) = 1.452306367636759
    2983,  // atan(8.7) = 1.4563560215248332
    2990,  // atan(9.0) = 1.460139105621001
    2998,  // atan(9.299999999999999) = 1.4636810034426648
    3004,  // atan(9.6) = 1.4670039863378537
    3011,  // atan(9.9) = 1.4701276746370677
    3017,  // atan(10.2) = 1.473069419436178
    3023,  // atan(10.5) = 1.4758446204521403
    3028,  // atan(10.799999999999999) = 1.4784669920632976
    3033,  // atan(11.1) = 1.480948787100269
    3038,  // atan(11.4) = 1.4833009859925053
    3042,  // atan(11.7) = 1.4855334573543673
};

namespace Utility {
    template<typename T, uint8_t P>
    fixed<T,P> sin(const fixed<T,P> & x) {
        using FXP = fixed<T,P>;
        FXP x_abs = x < 0 ? x.abs() + FXP::PI : x;
        uint8_t i = static_cast<uint8_t>(Utility::lerp(FXP(0), FXP(39), (x_abs % FXP::HALF_PI) / FXP::HALF_PI).floor());
        int8_t pos_neg = (x_abs / FXP::PI).floor() % 2 == 0 ? 1 : -1; 
        return SIN_LUT[i] * pos_neg;
    }
};